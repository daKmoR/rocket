<script type="module">
  import {installDarkModeHandler} from 'pwa-helper-components';
  import {GenericSwitch} from '@thepassle/generic-components/generic-switch/GenericSwitch.js';

  const $html = document.getElementsByTagName('html')[0];
  const htmlClassList = $html.classList;

  class LaunchDarkSwitch extends GenericSwitch {
    constructor() {
      super();

      if (htmlClassList.contains('dark')) {
        this.setAttribute('checked', '');
      } else {
        this.removeAttribute('checked');
      }

      this.observer = new MutationObserver(() => {
        if (htmlClassList.contains('dark')) {
          this.setAttribute('checked', '');
        } else {
          this.removeAttribute('checked');
        }
      });
    }

    connectedCallback() {
      super.connectedCallback();
      installDarkModeHandler();
      this.addEventListener('checked-changed', this.checkedChangedHandler);
      this.observer.observe($html, {
        attributes: true, childList: false, characterData: false
      });
    }

    disconnectedCallback() {
      super.disconnectedCallback();
      this.observer.disconnect();
    }

    checkedChangedHandler() {
      if (this.__checked) {
        htmlClassList.add('dark');
        localStorage.setItem('darkmode', 'true');
      } else {
        htmlClassList.remove('dark');
        localStorage.setItem('darkmode', 'false');
      }
    }
  }

  customElements.define('launch-dark-switch', LaunchDarkSwitch);
</script>

<noscript>
  <style type="text/css">
    @media (prefers-color-scheme: dark) {
      html {
        --primary-color: #e63946;
        --primary-color-lighter: #e25761;
        --primary-color-darker: #a22831;
        --primary-color-accent: #cee5f6;
        --primary-text-color: #eee;

        /* Contrast colors */
        --contrast-color-light: #fff;
        --contrast-color-dark: #1d3557;

        /* background-colors */
        --page-background: #333;
        --footer-background: #4f4f4f;

        --text-color: white;

        --markdown-octicon-link: white;
        --markdown-syntax-background-color: #a0a0a0;
        --markdown-link-color: #fb7881;
        --markdown-blockquote-color: #c9e3ff;
      }
    }
  </style>
</noscript>
